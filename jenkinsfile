pipeline{
    agent {label 'terraform-node'}
    parameters{
        choice(name:'action', choices:['apply','destroy'],description:'Select Terraform action')
    }
    stages{
        stage('Checkout Code'){
            steps{
                checkout scm
            }
        }     
        stage('Terraform Format Check'){
            steps{
                sh 'terraform fmt'
            }
        }
        stage('Terraform Init'){
            steps{                
                sh 'terraform init'
            }
        }
        stage('Terraform action'){
            steps{
                withCredentials([[$class:'AmazonWebServicesCredentialsBinding', credentialsId: 'aws-credentials']]){
                    sh '''
                    echo "Terraform action is ---> ${action}"
                    terraform ${action} --auto-approve
                    '''                    
                }
            }
        }

    }

  
    }}
